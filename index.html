<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Helpers for identifying R functions in files.
  Created to help with spotting which functions and 
  packages were used in some popular R repositories.">
<title>Identify Functions &amp; Packages in Files • funspotr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Identify Functions &amp; Packages in Files">
<meta property="og:description" content="Helpers for identifying R functions in files.
  Created to help with spotting which functions and 
  packages were used in some popular R repositories.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">funspotr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/brshallo/funspotr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="funspotr">funspotr<a class="anchor" aria-label="anchor" href="#funspotr"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of funspotr (R function spotter) is to make it easy to identify which functions and packages are used in files. It was initially written to map out the functions and packages used in a few popular github repositories (see <a href="https://github.com/brshallo/funspotr-examples" class="external-link">brshallo/funspotr-examples</a> and associated <a href="https://www.bryanshalloway.com/2022/01/18/identifying-r-functions-packages-used-in-github-repos/" class="external-link">blog post</a>).</p>
<p>funspotr is primarily designed for self-contained scripts (see <a href="#package-dependencies-in-another-file">Package dependencies in another file</a>). Also, it may not identify <em>every</em> function and/or package (see <a href="#limitations-problems-musings">Limitations, Problems, Musings</a>) or read the source code for details.</p>
<div class="section level2">
<h2 id="spot-functions-in-a-file">Spot functions in a file<a class="anchor" aria-label="anchor" href="#spot-functions-in-a-file"></a>
</h2>
<p>The primary function in funspotr is <code><a href="reference/spot_funs.html">spot_funs()</a></code> which returns a dataframe showing the functions and associated packages used in a file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://brshallo.github.io/funspotr/">funspotr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="va">file_lines</span> <span class="op">&lt;-</span> <span class="st">"
library(dplyr)
require(tidyr)

as_tibble(mpg) %&gt;% 
  mutate(class = as.character(class)) %&gt;%
  group_by(class) %&gt;%
  nest() %&gt;%
  mutate(stats = purrr::map(data,
                            ~lm(cty ~ hwy, data = .x)))
 
made_up_fun()
"</span>

<span class="va">file_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".R"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">file_lines</span>, <span class="va">file_output</span><span class="op">)</span>

<span class="fu"><a href="reference/spot_funs.html">spot_funs</a></span><span class="op">(</span>file_path <span class="op">=</span> <span class="va">file_output</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;    funs         pkgs      in_multiple_pkgs</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;     &lt;lgl&gt;           </span>
<span class="co">#&gt;  1 library      base      FALSE           </span>
<span class="co">#&gt;  2 require      base      FALSE           </span>
<span class="co">#&gt;  3 as_tibble    tidyr     TRUE            </span>
<span class="co">#&gt;  4 mutate       dplyr     FALSE           </span>
<span class="co">#&gt;  5 as.character base      FALSE           </span>
<span class="co">#&gt;  6 group_by     dplyr     FALSE           </span>
<span class="co">#&gt;  7 nest         tidyr     FALSE           </span>
<span class="co">#&gt;  8 map          purrr     FALSE           </span>
<span class="co">#&gt;  9 lm           stats     FALSE           </span>
<span class="co">#&gt; 10 made_up_fun  (unknown) FALSE</span></code></pre></div>
<ul>
<li>
<code>funs</code>: function used in script</li>
<li>
<code>pkgs</code>: best guess as to the package it came from</li>
<li>
<code>in_multiple_pkgs</code> : Whether the function has multiple packages/environments on it’s (guessed) search space. By default only the package at the top of the search space is returned[1].</li>
</ul>
<!-- The example below uses `spot_pkgs_from_DESCRIPTION()` to load in package dependencies and then passes the resulting character vector to `spot_funs_custom()`. -->
</div>
<div class="section level2">
<h2 id="spot-functions-in-a-github-repo">Spot functions in a github repo<a class="anchor" aria-label="anchor" href="#spot-functions-in-a-github-repo"></a>
</h2>
<p><code><a href="reference/github_spot_things.html">github_spot_funs()</a></code> is a wrapper on <code><a href="reference/spot_funs.html">spot_funs()</a></code> that maps it across all R or Rmarkdown files in a github repository.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># repo for an old presentation I gave</span>
<span class="va">gh_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/github_spot_things.html">github_spot_funs</a></span><span class="op">(</span>
  repo <span class="op">=</span> <span class="st">"brshallo/feat-eng-lags-presentation"</span>, 
  branch <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span>

<span class="va">gh_ex</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;   contents                         urls                               spotted   </span>
<span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;                              &lt;list&gt;    </span>
<span class="co">#&gt; 1 R/Rmd-to-R.R                     https://raw.githubusercontent.com~ &lt;named li~</span>
<span class="co">#&gt; 2 R/feat-engineering-lags.R        https://raw.githubusercontent.com~ &lt;named li~</span>
<span class="co">#&gt; 3 R/load-inspections-save-csv.R    https://raw.githubusercontent.com~ &lt;named li~</span>
<span class="co">#&gt; 4 R/types-of-splits.R              https://raw.githubusercontent.com~ &lt;named li~</span>
<span class="co">#&gt; 5 feat-eng-lags-presentation.Rproj https://raw.githubusercontent.com~ &lt;named li~</span></code></pre></div>
<ul>
<li>
<code>contents</code> : filepath in github repo</li>
<li>
<code>urls</code>: URL to raw file on github</li>
<li>
<code>spotted</code>: <code><a href="https://purrr.tidyverse.org/reference/safely.html" class="external-link">purrr::safely()</a></code> style list-column of results when mapping <code><a href="reference/spot_funs.html">spot_funs()</a></code> across <code>urls</code>[2].</li>
</ul>
<p>These results may then be unnested with the helper <code><a href="reference/unnest_github_results.html">funspotr::unnest_github_results()</a></code> to provide a table of which functions and packages are used. This can be manipulated like any other dataframe – say we want to filter to those files where <a href="https://here.r-lib.org/" class="external-link">here</a>, <a href="https://readr.tidyverse.org/" class="external-link">readr</a> or <a href="https://rsample.tidymodels.org/" class="external-link">rsample</a> packages are used.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gh_ex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/unnest_github_results.html">unnest_github_results</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"here"</span>, <span class="st">"readr"</span>, <span class="st">"rsample"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 x 5</span>
<span class="co">#&gt;   funs               pkgs    in_multiple_pkgs contents      urls                </span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;chr&gt;   &lt;lgl&gt;            &lt;chr&gt;         &lt;chr&gt;               </span>
<span class="co">#&gt; 1 here               here    FALSE            R/Rmd-to-R.R  https://raw.githubu~</span>
<span class="co">#&gt; 2 read_csv           readr   FALSE            R/feat-engin~ https://raw.githubu~</span>
<span class="co">#&gt; 3 initial_time_split rsample TRUE             R/feat-engin~ https://raw.githubu~</span>
<span class="co">#&gt; 4 training           rsample TRUE             R/feat-engin~ https://raw.githubu~</span>
<span class="co">#&gt; 5 testing            rsample TRUE             R/feat-engin~ https://raw.githubu~</span>
<span class="co">#&gt; 6 sliding_period     rsample TRUE             R/feat-engin~ https://raw.githubu~</span>
<span class="co">#&gt; 7 write_csv          readr   FALSE            R/load-inspe~ https://raw.githubu~</span>
<span class="co">#&gt; 8 here               here    FALSE            R/load-inspe~ https://raw.githubu~</span></code></pre></div>
<p>You can set <code>preview = TRUE</code> in <code><a href="reference/github_spot_things.html">github_spot_funs()</a></code> to first view the files you intend to parse.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">preview_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/github_spot_things.html">github_spot_funs</a></span><span class="op">(</span>
  repo <span class="op">=</span> <span class="st">"brshallo/feat-eng-lags-presentation"</span>, 
  branch <span class="op">=</span> <span class="st">"main"</span>,
  preview <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">preview_files</span>
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   contents                         urls                                         </span>
<span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;                                        </span>
<span class="co">#&gt; 1 R/Rmd-to-R.R                     https://raw.githubusercontent.com/brshallo/f~</span>
<span class="co">#&gt; 2 R/feat-engineering-lags.R        https://raw.githubusercontent.com/brshallo/f~</span>
<span class="co">#&gt; 3 R/load-inspections-save-csv.R    https://raw.githubusercontent.com/brshallo/f~</span>
<span class="co">#&gt; 4 R/types-of-splits.R              https://raw.githubusercontent.com/brshallo/f~</span>
<span class="co">#&gt; 5 feat-eng-lags-presentation.Rproj https://raw.githubusercontent.com/brshallo/f~</span></code></pre></div>
<p>You can pass in a custom set of urls by inputting a dataframe to the argument <code>custom_urls</code> – this may be the output of a previous call where <code>preview = TRUE</code>. For examle, say we only want to parse the “types-of-splits.R” and “Rmd-to-R.R” files.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">preview_files</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">contents</span>, <span class="st">"types-of-splits|Rmd-to-R"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/github_spot_things.html">github_spot_funs</a></span><span class="op">(</span>custom_urls <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/unnest_github_results.html">unnest_github_results</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 24 x 5</span>
<span class="co">#&gt;    funs      pkgs      in_multiple_pkgs contents            urls                </span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;lgl&gt;            &lt;chr&gt;               &lt;chr&gt;               </span>
<span class="co">#&gt;  1 purl      knitr     FALSE            R/Rmd-to-R.R        https://raw.githubu~</span>
<span class="co">#&gt;  2 here      here      FALSE            R/Rmd-to-R.R        https://raw.githubu~</span>
<span class="co">#&gt;  3 library   base      FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt;  4 theme_set ggplot    FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt;  5 theme_bw  ggplot    FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt;  6 set.seed  base      FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt;  7 tibble    dplyr     TRUE             R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt;  8 rep       base      FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt;  9 today     lubridate FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt; 10 days      lubridate FALSE            R/types-of-splits.R https://raw.githubu~</span>
<span class="co">#&gt; # ... with 14 more rows</span></code></pre></div>
<p>The <code>custom_urls</code> argument works for any situation where you want to map <code><a href="reference/spot_funs.html">spot_funs()</a></code> across a set of filepaths or URLs. E.g. see example in <code><a href="reference/github_gists.html">github_gists()</a></code> for a case where this argument is used to parse functions/packages from a specified github user’s gists.</p>
</div>
<div class="section level2">
<h2 id="files-you-didnt-write">Files you didn’t write<a class="anchor" aria-label="anchor" href="#files-you-didnt-write"></a>
</h2>
<p>Functions created in the file as well as functions from unavailable packages (or packages that don’t exist) will output as <code>pkgs = "(unknown)"</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file_lines_missing_pkgs</span> <span class="op">&lt;-</span> <span class="st">"
library(dplyr)

as_tibble(mpg)

hello_world &lt;- function() print('hello world')

madeuppkg::made_up_fun()

hello_world()
"</span>

<span class="va">missing_pkgs_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".R"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">file_lines_missing_pkgs</span>, <span class="va">missing_pkgs_ex</span><span class="op">)</span>

<span class="fu"><a href="reference/spot_funs.html">spot_funs</a></span><span class="op">(</span>file_path <span class="op">=</span> <span class="va">missing_pkgs_ex</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;   funs        pkgs      in_multiple_pkgs</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;     &lt;lgl&gt;           </span>
<span class="co">#&gt; 1 library     base      FALSE           </span>
<span class="co">#&gt; 2 as_tibble   dplyr     FALSE           </span>
<span class="co">#&gt; 3 print       base      FALSE           </span>
<span class="co">#&gt; 4 made_up_fun (unknown) FALSE           </span>
<span class="co">#&gt; 5 hello_world (unknown) FALSE</span></code></pre></div>
<p><em>To spot which package a function is from you must have the package installed locally.</em> Hence for files on others’ github repos or that you created on a different machine, it is a good idea to start with <code><a href="reference/check_pkgs_availability.html">funspotr::check_pkgs_availability()</a></code> to see which packages you are missing.</p>
<p>A quick helper for installing missing packages (see “R/spot-pkgs.R” for documentation):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/check_pkgs_availability.html">check_pkgs_availability</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">funspotr</span><span class="fu">:::</span><span class="fu"><a href="reference/install_missing_pkgs.html">install_missing_pkgs</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Alternatively, you may want to clone the repository locally and then use <code>renv::dependencies()</code> and only then start using funspotr. <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> is a more robust approach to finding and installing dependencies – particularly in cases where you are missing many dependencies or don’t want to alter the packages in your global library.</p>
</div>
</div>
<div class="section level1">
<h1 id="other-things">Other Things<a class="anchor" aria-label="anchor" href="#other-things"></a>
</h1>
<div class="section level2">
<h2 id="package-dependencies-in-another-file">Package dependencies in another file<a class="anchor" aria-label="anchor" href="#package-dependencies-in-another-file"></a>
</h2>
<p><code><a href="reference/spot_funs.html">spot_funs()</a></code> is currently set-up for self-contained files. But <code><a href="reference/spot_funs_custom.html">spot_funs_custom()</a></code> allows the user to explicitly specify <code>pkgs</code> where functions may come from. This is useful in cases where the packages loaded are not in the same location as the <code>file_path</code> (e.g. they are loaded via <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> or a DESCRIPTION file, or some other workflow). For example, below is a made-up example where the <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> calls are made in a separate file and <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>d in.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># file where packages are loaded</span>
<span class="va">file_libs</span> <span class="op">&lt;-</span> <span class="st">"library(dplyr)
library(lubridate)"</span>

<span class="va">file_libs_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".R"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">file_libs</span>, <span class="va">file_libs_output</span><span class="op">)</span>

<span class="co"># File of interest where things happen</span>
<span class="va">file_run</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span>
<span class="st">"source('{ file_libs_output }')
  
tibble::tibble(days_from_today = 0:10) %&gt;% 
    mutate(date = today() + days(days_from_today))
"</span>, 
file_libs_output <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">file_libs_output</span>, <span class="st">"\\\\"</span>, <span class="st">"/"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">file_run_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".R"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">file_run</span>, <span class="va">file_run_output</span><span class="op">)</span>

<span class="co"># Identify packages using both files and then pass in explicitly to `spot_funs_custom()`</span>
<span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="reference/spot_pkgs.html">spot_pkgs</a></span><span class="op">(</span><span class="va">file_libs_output</span><span class="op">)</span>, 
          <span class="fu"><a href="reference/spot_pkgs.html">spot_pkgs</a></span><span class="op">(</span><span class="va">file_run_output</span>, show_explicit_funs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="reference/spot_funs_custom.html">spot_funs_custom</a></span><span class="op">(</span>
  pkgs <span class="op">=</span> <span class="va">pkgs</span>,
  file_path <span class="op">=</span> <span class="va">file_run_output</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;   funs   pkgs      in_multiple_pkgs</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           </span>
<span class="co">#&gt; 1 source base      FALSE           </span>
<span class="co">#&gt; 2 tibble tibble    TRUE            </span>
<span class="co">#&gt; 3 mutate dplyr     FALSE           </span>
<span class="co">#&gt; 4 today  lubridate FALSE           </span>
<span class="co">#&gt; 5 days   lubridate FALSE</span></code></pre></div>
<p>Also see <code>funspotr:::spot_pkgs_from_DESCRIPTION()</code>.</p>
</div>
<div class="section level2">
<h2 id="show-all-function-calls">Show all function calls<a class="anchor" aria-label="anchor" href="#show-all-function-calls"></a>
</h2>
<p>Passing in <code>show_each_use = TRUE</code> to <code>...</code> in <code>get_funs()</code> or <code><a href="reference/github_spot_things.html">github_spot_funs()</a></code> will return <em>all</em> instances of a function call rather than just once for each file.</p>
<p>Compared to the initial example, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> now shows-up at both rows 4 and 8:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/spot_funs.html">spot_funs</a></span><span class="op">(</span>file_path <span class="op">=</span> <span class="va">file_output</span>, show_each_use <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11 x 3</span>
<span class="co">#&gt;    funs         pkgs      in_multiple_pkgs</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;     &lt;lgl&gt;           </span>
<span class="co">#&gt;  1 library      base      FALSE           </span>
<span class="co">#&gt;  2 require      base      FALSE           </span>
<span class="co">#&gt;  3 as_tibble    tidyr     TRUE            </span>
<span class="co">#&gt;  4 mutate       dplyr     FALSE           </span>
<span class="co">#&gt;  5 as.character base      FALSE           </span>
<span class="co">#&gt;  6 group_by     dplyr     FALSE           </span>
<span class="co">#&gt;  7 nest         tidyr     FALSE           </span>
<span class="co">#&gt;  8 mutate       dplyr     FALSE           </span>
<span class="co">#&gt;  9 map          purrr     FALSE           </span>
<span class="co">#&gt; 10 lm           stats     FALSE           </span>
<span class="co">#&gt; 11 made_up_fun  (unknown) FALSE</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="helper-for-blogdown-tags">Helper for <a href="https://pkgs.rstudio.com/blogdown/" class="external-link">blogdown</a> tags<a class="anchor" aria-label="anchor" href="#helper-for-blogdown-tags"></a>
</h2>
<p>Setting <code>as_yaml_tags = TRUE</code> in <code><a href="reference/spot_pkgs.html">spot_pkgs()</a></code> flattens the dependencies and outputs them in a format that can be pasted into the <strong>tags</strong> section of a blogdown post’s YAML header. See (<a href="https://github.com/rstudio/blogdown/issues/647" class="external-link">blogdown#647</a>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Example from old blogdown post</span>
<span class="fu"><a href="reference/spot_pkgs.html">spot_pkgs</a></span><span class="op">(</span>
  file_path <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/brshallo/brshallo/master/content/post/2020-02-06-maximizing-magnetic-volume-the-perfect-bowl.Rmd"</span>,
  as_yaml_tags <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;   - knitr</span>
<span class="co">#&gt;   - tidyverse</span>
<span class="co">#&gt;   - ggforce</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="unexported-functions">Unexported functions<a class="anchor" aria-label="anchor" href="#unexported-functions"></a>
</h2>
<p>Many of the unexported functions (in “R/github-spot.R” in particular) may be helpful in building up other workflows for mapping <code><a href="reference/spot_funs.html">spot_funs()</a></code> across multiple files[3] <em>If you have a suggestion for a function or set of functions for spotting functions, feel free to open an issue.</em></p>
<!-- **If you've used {funspotr} to map the R functions and packages of a public blog or repository, open an issue to add a link in the README.** -->
</div>
</div>
<div class="section level1">
<h1 id="how-funspotrspot_funs-works">How <code>funspotr::spot_funs()</code> works<a class="anchor" aria-label="anchor" href="#how-funspotrspot_funs-works"></a>
</h1>
<p>At a high-level…</p>
<ol style="list-style-type: decimal">
<li>Create a new R instance using <a href="https://github.com/r-lib/callr" class="external-link">callr</a>
</li>
<li>Load packages. Explicit calls (e.g. <code>pkg::fun()</code>) are loaded individually via <a href="https://github.com/rticulate/import" class="external-link">import</a> and are loaded last (putting them at the top of the search space)[4].</li>
</ol>
<p>(steps 1 and 2 needed so that step 4 has the best chance of identifying the package a function comes from in the file.)</p>
<ol start="3" style="list-style-type: decimal">
<li>Pass file through <code><a href="https://rdrr.io/r/utils/getParseData.html" class="external-link">utils::getParseData()</a></code> and filter to just functions (inspired by <code><a href="https://rdrr.io/pkg/NCmisc/man/list.functions.in.file.html" class="external-link">NCmisc::list.functions.in.file()</a></code>)</li>
<li>Pass functions through <code><a href="https://rdrr.io/r/utils/apropos.html" class="external-link">utils::find()</a></code> to identify associated package</li>
</ol>
</div>
<div class="section level1">
<h1 id="limitations-problems-musings">Limitations, Problems, Musings<a class="anchor" aria-label="anchor" href="#limitations-problems-musings"></a>
</h1>
<ul>
<li>If a file contains R syntax that is not well defined it will not be parsed and return an error. See <a href="https://yihui.org/formatr/#6-further-notes" class="external-link">formatR</a> (used by {funspotr} in parsing) for other common reasons for failure.</li>
<li>
<code><a href="https://rdrr.io/pkg/knitr/man/read_chunk.html" class="external-link">knitr::read_chunk()</a></code> and <code><a href="https://rdrr.io/pkg/knitr/man/knit.html" class="external-link">knitr::purl()</a></code> in a file passed to {funspotr} will also frequently cause an error in parsing. See <a href="https://github.com/yihui/knitr/issues/1753" class="external-link">knitr#1753</a> &amp; <a href="https://github.com/yihui/knitr/issues/1938" class="external-link">knitr#1938</a>
</li>
<li>Please open an issue if you find other cases where it breaks :-) .</li>
<li>As mentioned elsewhere, the default parsing of <code><a href="reference/spot_funs.html">spot_funs()</a></code> is primarily for cases where package dependencies are loaded in the same file that they are used in[5]. Scripts that are not self-contained typically should have the <code>pkgs</code> argument provided explicitly via <code><a href="reference/spot_funs_custom.html">spot_funs_custom()</a></code>.</li>
<li>funspotr does not pay attention to when functions are reexported from elsewhere. For example, many tibble functions are reexported by dplyr and tidyr – funspotr though will not know the true home of these functions it is simply looking at the top of the search space[6].</li>
<li>Feel free to open an issue if you’d be interested in a simplifying function or vignette for mapping <code><a href="reference/spot_funs.html">spot_funs()</a></code> through local repos or other folder structures other than github respositories (which is already covered in <code><a href="reference/github_spot_things.html">github_spot_funs()</a></code>)[7]</li>
<li>All the functions in “R/spot-pkgs.R” would probably be better handled by something like <code>renv::dependencies()</code> or a parsing based approach. The simple regex’s I use have a variety of problems. As just one example <code>funspotr::get_pkgs()</code> will not recognize when a package is within quotes or being escaped[8].</li>
<li>I am curiuos if there is something to be learned from how <code>R CMD check</code> does function parsing.
<ul>
<li>`funspotr’s current approach is slow</li>
<li>Current approach uses some imperfect heuristics</li>
</ul>
</li>
<li>Does not identify infix operators, e.g. <code>+</code> (maybe fine though)</li>
<li>
<code>funspotr</code> has lots of dependencies. It may have make sense to move some of the non-core functionality into a separate package (e.g. everything “R/github-spot.R”)</li>
<li>It may have made more sense to have <code>github_get_funs()</code> clone the repo locally rather than pointing to URL’s to parse each file.</li>
<li>Currently is possible to have github block you pretty soon due to hitting too many files (in which case you’ll likely get a 403 or connection error). There are some things that could probably be done to reduce number of github API hits (e.g. above bullet, <code><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep()</a></code>, …).</li>
<li>Throughout the code and package documentation I have “inspiration” bullets followed by a link pointing to places where I took stuff from stack overflow, github, or other packages</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of funspotr from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"brshallo/funspotr"</span><span class="op">)</span></code></pre></div>
<p>[1] E.g. <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble()</a></code> is attributed to <a href="https://tidyr.tidyverse.org/" class="external-link">tidyr</a> by <code><a href="reference/spot_funs.html">spot_funs()</a></code> however <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble()</a></code> is also in <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a>. I don’t worry about getting to the root source of the package or the fact that both of those packages are just reexporting it from <a href="https://tibble.tidyverse.org/" class="external-link">tibble</a>. Setting <code>keep_search_list = TRUE</code> will return rows for each item in the search list which may be helpful if getting unexpected results.)</p>
<p>[2] If any file could not be parsed will be a <code><a href="https://purrr.tidyverse.org/reference/safely.html" class="external-link">purrr::safely()</a></code> list-column output where each item is a list containing <code>result</code> and <code>error</code>.</p>
<p>[3] Most unexported functions in <code>funspotr</code> still include a man file and at least partial documentation.</p>
<p>[4] This heuristic is imperfect and means that a file with “library(dplyr); select(); MASS::select()” would view both <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> calls as coming from {MASS} – when what it should do is view the first was as coming from {dplyr} and the second from {MASS}.</p>
<p>[5] i.e. in interactive R scripts or Rmd documents where you use <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> or related calls within the script.</p>
<p>[6] For example when reviewing David Robinson’s Tidy Tuesday code I found that the <a href="https://github.com/GuangchuangYu/meme" class="external-link">meme</a> package was used far more than I would have expected. Turns out it was just due to it reexporting the aes() function from ggplot.</p>
<p>[7] E.g. for mapping across a local repository, across a package, a data workflow, etc.</p>
<p>[8] e.g. in this case <code>lines &lt;- "library(pkg)"</code> the <code>pkg</code> would show-up as a dependency despite just being part of a quote rather than actually loaded.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/brshallo/funspotr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/brshallo/funspotr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing funspotr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Bryan Shalloway <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bryan Shalloway.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
